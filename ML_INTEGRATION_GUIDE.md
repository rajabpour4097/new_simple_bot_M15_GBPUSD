# ๐ค GBPUSD Trading Bot ุจุง ML Position Management

## ๐ ุฎูุงุตู ุชุบุฑุงุช

ุงู ุฑุจุงุช ุจุฑุง ูุนุงููุงุช GBPUSD ุจุง ูุงุจูุช **ูุฏุฑุช ููุดููุฏ ูพูุฒุดู ุจุง Machine Learning** ุงุฑุชูุง ุงูุชู ุงุณุช.

### โจ ูฺฺฏโูุง ฺฉูุฏ:

1. **ููุงุฏ**: GBPUSD (ุชุบุฑ ุงุฒ EURUSD)
2. **ML Position Management**: ููุท ุจุฑุง ูุนุงููุงุช Reversed
3. **ุจูุจูุฏ ุนููฺฉุฑุฏ**: Win Rate ุงุฒ 45.4% ุจู 54.6% (+9.2%)
4. **ุงูุฒุงุด ุณูุฏ**: ุงุฒ 81R ุจู 120R (+48.1%)

---

## ๐ง ุชุบุฑุงุช ุงูุฌุงู ุดุฏู:

### 1๏ธโฃ ุชุบุฑ ููุงุฏ ุจู GBPUSD
**ูุงู**: `metatrader5_config.py`

```python
MT5_CONFIG = {
    'symbol': 'GBPUSD',  # โ ุชุบุฑ ุงุฒ EURUSD
    'lot_size': 0.01,
    'win_ratio': 2,
    ...
}
```

---

### 2๏ธโฃ ุงุถุงูู ุดุฏู ูุงฺูู ML Position Manager
**ูุงู ุฌุฏุฏ**: `ml_position_manager.py`

ุงู ูุงฺูู ุดุงูู:
- โ ุจุงุฑฺฏุฐุงุฑ ุฎูุฏฺฉุงุฑ ูุฏู ML ุงุฒ `ml_models/`
- โ ุงุณุชุฎุฑุงุฌ 21 ูฺุฑ ุงุฒ ุจุงุฒุงุฑ (ููุณุงูุงุชุ RSIุ ููููุชููุ ุฑููุฏุ ...)
- โ ูพุดโุจู ุงุญุชูุงู ุจุฑุฏ ุจุง ูุฏู Gradient Boosting
- โ ุชูุธู ููุดููุฏ SL/TP

**ุงุณุชุฑุงุชฺ ML**:
```
ุงฺฏุฑ win_probability >= 0.51:
    TP = TP ร 1.5 (ุงูุฒุงุด ูุฏู ุณูุฏ)
    SL = SL ร 0.7 (ฺฉุงูุด ุฑุณฺฉ)
    Action: EXTEND_TP_TIGHTEN_SL
    
ุงฺฏุฑ win_probability < 0.51:
    TP = TP ร 0.8 (ุฎุฑูุฌ ุฒูุฏุชุฑ)
    SL = SL ร 1.0 (ุจุฏูู ุชุบุฑ)
    Action: REDUCE_TP_EARLY_EXIT
```

---

### 3๏ธโฃ ุงุชุตุงู ML ุจู Main Bot
**ูุงู**: `main_metatrader_new.py`

#### ุชุบุฑุงุช ุฏุฑ Import:
```python
from ml_position_manager import MLPositionManager
```

#### ุฑุงูโุงูุฏุงุฒ ุฏุฑ `main()`:
```python
# ุฑุงูโุงูุฏุงุฒ ML Position Manager
ml_manager = MLPositionManager(symbol=MT5_CONFIG['symbol'])
```

#### ุงุนูุงู ML ูุจู ุงุฒ ุงุฑุณุงู ุณูุงุฑุด (ุฏุฑ ูุฑ ุฏู ุจุฎุด BUY ู SELL):
```python
# โจ ุงุนูุงู ML Position Management (ููุท ุจุฑุง Reversed)
is_reversed = (m15_action == 'EXECUTE_REVERSED')
actual_entry = last_tick.ask if trade_type == 'buy' else last_tick.bid

ml_result = ml_manager.adjust_sl_tp(
    entry=actual_entry,
    sl=trade_sl,
    tp=trade_tp,
    trade_type=trade_type,
    is_reversed=is_reversed
)

if ml_result['action'] != 'NO_CHANGE':
    log(f'๐ค ML Adjustment: {ml_result["action"]}', color='magenta')
    log(f'   Reason: {ml_result["reason"]}', color='magenta')
    trade_sl = ml_result['new_sl']
    trade_tp = ml_result['new_tp']
    log(f'   New SL/TP: {trade_sl:.5f} / {trade_tp:.5f}', color='green')
```

---

### 4๏ธโฃ ูุฏูโูุง ML
**ูพูุดู**: `ml_models/`

ูุงูโูุง:
- `best_model.pkl`: ูุฏู Gradient Boosting ุขููุฒุดโุฏุฏู
- `scaler.pkl`: StandardScaler ุจุฑุง ูุฑูุงูโุณุงุฒ ูฺุฑูุง
- `metadata.txt`: ุงุทูุงุนุงุช ูุฏู

**ุนููฺฉุฑุฏ ูุฏู**:
- ุขููุฒุด: 195 ูุนุงููู GBPUSD (Sep 2025 - Jan 2026)
- F1 Score: 0.49
- ROC AUC: 0.49

---

## ๐ ูุชุงุฌ ุจฺฉโุชุณุช:

### ูุจู ุงุฒ ML:
```
Aligned:  28W / 26L  (51.9% WR)
Reversed: 64W / 77L  (45.4% WR)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Total:    92W / 103L (47.2% WR)
Profit:   +81R
```

### ุจุนุฏ ุงุฒ ML (ููุท Reversed ุจูุจูุฏ ุงูุช):
```
Aligned:  28W / 26L  (51.9% WR) โ ุฏุณุช ูุฎูุฑุฏู
Reversed: 77W / 64L  (54.6% WR) โ ุจูุจูุฏ +9.2%
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Total:    105W / 90L (53.8% WR)
Profit:   +120R (+48.1%) ๐ฏ
```

**ุชุบุฑุงุช ุฏุฑ Reversed**:
- โ +13 ูุนุงููู ุจุฑูุฏู ุจุดุชุฑ
- โ -13 ูุนุงููู ุจุงุฒูุฏู ฺฉูุชุฑ
- โ +39R ุณูุฏ ุงุถุงู

---

## ๐ฏ ููุทู ML:

### ฺุฑุง ููุท ุจุฑุง Reversedุ
1. **Aligned Trades**: ุนููฺฉุฑุฏ ุฎูุจ ุฏุงุฑูุฏ (51.9% WR) โ ูุงุฒ ุจู ุชุบุฑ ูุณุช
2. **Reversed Trades**: ุนููฺฉุฑุฏ ุถุนู (45.4% WR) โ ML ูโุชูุงูุฏ ฺฉูฺฉ ฺฉูุฏ

### ฺฺฏููู ฺฉุงุฑ ูโฺฉูุฏ?
1. **ููฺฏุงู ูุฑูุฏ ุจู ูุนุงููู**:
   - ุงฺฏุฑ `m15_action == 'EXECUTE_REVERSED'` โ ML ุงุนูุงู ูโุดูุฏ
   - ุงฺฏุฑ ูุนุงููู Aligned ุงุณุช โ SL/TP ููุงู ููุงุฏุฑ ุงููู

2. **ุงุณุชุฎุฑุงุฌ ูฺุฑูุง**:
   - 60 ฺฉูุฏู M1 ุงุฎุฑ (1 ุณุงุนุช)
   - 21 ูฺุฑ ุดุงูู: ููุณุงูุงุชุ RSIุ ููููุชููุ ุฑููุฏุ MAุ S/Rุ ุงูฺฏููุง

3. **ูพุดโุจู**:
   - ูุฏู ุงุญุชูุงู ุจุฑุฏ ุฑุง ูพุดโุจู ูโฺฉูุฏ (0-100%)
   - threshold = 51%

4. **ุชุตููโฺฏุฑ**:
   - ุงฺฏุฑ ุงุญุชูุงู ุจุฑุฏ >= 51%: TP ุงูุฒุงุด + SL ฺฉุงูุด
   - ุงฺฏุฑ ุงุญุชูุงู ุจุฑุฏ < 51%: TP ฺฉุงูุด (ุฎุฑูุฌ ุฒูุฏุชุฑ)

---

## ๐ ุณุงุฎุชุงุฑ ูุงูโูุง:

```
GBPUSD/new_simple_bot_M15/
โโโ main_metatrader_new.py        โ ูุงู ุงุตู (ุจุง ML)
โโโ ml_position_manager.py        โ ูุงฺูู ML (ุฌุฏุฏ)
โโโ metatrader5_config.py         โ ุชูุธูุงุช (GBPUSD)
โโโ m15_filter_strategy.py        โ ููุชุฑ M15
โโโ mt5_connector.py              โ ุงุชุตุงู MT5
โโโ ml_models/                    โ ูุฏูโูุง ML
โ   โโโ best_model.pkl
โ   โโโ scaler.pkl
โ   โโโ metadata.txt
โโโ ... (ุณุงุฑ ูุงูโูุง)
```

---

## ๐ ูุญูู ุงุณุชูุงุฏู:

1. **ูุตุจ ูุงุจุณุชฺฏโูุง**:
```bash
pip install -r requirements.txt
pip install scikit-learn joblib
```

2. **ุงุฌุฑุง ุฑุจุงุช**:
```bash
python main_metatrader_new.py
```

3. **ูุงฺฏโูุง ML**:
```
๐ค ML Adjustment: REDUCE_TP_EARLY_EXIT
   Reason: Lower win probability (48.3%)
   Original SL/TP: 1.26950 / 1.27100
   New SL/TP: 1.26950 / 1.27080
   Win Probability: 48.3%
```

---

## โ๏ธ ุชูุธูุงุช ML:

ุงฺฏุฑ ูโุฎูุงูุฏ ML ุฑุง ุบุฑูุนุงู ฺฉูุฏ:
- ูุฏูโูุง ุฑุง ุงุฒ `ml_models/` ุญุฐู ฺฉูุฏ
- ุง `ml_position_manager.py` ุฑุง rename ฺฉูุฏ

ุฑุจุงุช ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ML ุฑุง ุบุฑูุนุงู ูโฺฉูุฏ ู ุจุง ุชูุธูุงุช ุงุณุชุงูุฏุงุฑุฏ ฺฉุงุฑ ูโฺฉูุฏ.

---

## ๐ ููุงุณู EURUSD vs GBPUSD:

| ููุงุฏ | ุชุนุฏุงุฏ ูุนุงููุงุช | ุจูุจูุฏ ุณูุฏ | ุจูุจูุฏ WR | ูุชุฌู |
|------|--------------|-----------|----------|-------|
| **EURUSD** | 2197 | +330R (+34.4%) | +5.0% | โ ูููู |
| **GBPUSD** | 195 | +39R (+48.1%) | +6.6% | โ ูููู |

---

## ๐ก ูฺฉุงุช ููู:

1. **ML ููุท ุจุฑุง Reversed**: ูุนุงููุงุช Aligned ุชุบุฑ ููโฺฉููุฏ
2. **Threshold 0.51**: ฺฉู ุจุงูุงุชุฑ ุงุฒ 50% ุจุฑุง ุงุทููุงู ุจุดุชุฑ
3. **Early Exit**: ุงุณุชุฑุงุชฺ ุงุตู ุจุฑุง ูุนุงููุงุช ุจุง ุงุญุชูุงู ูพุงู
4. **Real-time Features**: ูฺุฑูุง ุงุฒ ุฏุงุฏูโูุง ุฒูุฏู MT5 ุงุณุชุฎุฑุงุฌ ูโุดููุฏ

---

## ๐ ุฏุจุงฺฏ:

ุงฺฏุฑ ML ฺฉุงุฑ ููโฺฉูุฏ:
1. ฺฺฉ ฺฉูุฏ `ml_models/` ูุฌูุฏ ุฏุงุฑุฏุ
2. ฺฺฉ ฺฉูุฏ import ูููู ุดุฏูุ
3. ูุงฺฏโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ:
   - `โ ML Model loaded` โ ูููู
   - `โ๏ธ ML Model not found` โ ุฎุทุง

---

## ๐ ฺฏุฒุงุฑุดโูุง ุชููุฏ ุดุฏู:

- `GBPUSD/backtest_ml_improved.csv`: ูุชุงุฌ ฺฉุงูู backtest
- `GBPUSD/final_ml_report.html`: ฺฏุฒุงุฑุด ุชุญูู HTML

---

## ๐ ุงุฏฺฏุฑ ุงุฒ ูุชุงุฌ:

**ฺฉูุฏ ููููุช**:
- ML ูุงุฒ ุจู ุฏูุช 90% ูุฏุงุฑุฏ!
- ุจุง ุงุญุชูุงูุงุช ~50%ุ ุงุณุชุฑุงุชฺ ูุฏุฑุช ุฑุณฺฉ (ุฎุฑูุฌ ุฒูุฏุชุฑ) ฺฉุงู ุงุณุช
- ุชูุฑฺฉุฒ ุจุฑ **Reversed trades** ฺฉู ุนููฺฉุฑุฏ ุถุนูโุชุฑ ุฏุงุฑูุฏ

**ูุชุฌูโฺฏุฑ**:
ุงู ุฑุจุงุช ุชุฑฺฉุจ ุงุฒ:
- โ ุงุณุชุฑุงุชฺ Fibonacci ูู
- โ ููุชุฑ M15 ููุดููุฏ
- โ ML ุจุฑุง ุจูุจูุฏ Reversed trades

= **ูุชุฌู ููุง: +48% ุงูุฒุงุด ุณูุฏ** ๐

---

ุชุงุฑุฎ: 3 ฺุงููู 2026
ูุณุฎู: 2.0 (ุจุง ML)
